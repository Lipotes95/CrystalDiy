"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const e=require("./common/vendor.js"),t=require("./common/utils.js"),a=require("./env/config.js"),n=require("./common/onfire.js"),o=require("./common/gotopage.js"),i=require("./utils/request.js"),r=require("./utils/validator.js"),s=require("./store/index.js");Math;const c={onLaunch:function(e){console.log("App Launch"),this.updateManager(),this.onStartupScene(e.query),this.getNav()},onShow:function(){},onHide:function(){},methods:{isFirstEnter(){var t=e.index.getStorageSync("firstEnter");e.index.getSystemInfo({success(a){console.log("firstEnter="+t),"ios"!=a.platform||t||(console.log("---------------"),e.index.navigateTo({url:"/pages/privacy/privacy"}))}})},updateManager:function(){const t=e.index.getUpdateManager();t.onCheckForUpdate((function(a){a.hasUpdate&&t.onUpdateReady((function(a){e.index.showModal({title:"更新提示",content:"新版本已经准备好，即将重启应用",showCancel:!1,success(e){e.confirm&&t.applyUpdate()}})}))})),t.onUpdateFailed((function(t){e.index.showModal({title:"更新提示",content:"检查到有新版本，但下载失败，请检查网络设置",showCancel:!1})}))},onStartupScene(a){let n=t.utils.getSceneData(a),o=a.referee_id;o>0&&(e.index.getStorageSync("referee_id")||e.index.setStorageSync("referee_id",o));let i=n.uid;i>0&&(e.index.getStorageSync("referee_id")||e.index.setStorageSync("referee_id",i))},getNav(){e.index.request({url:this.config.app_url+"/index.php/api/index/nav",data:{app_id:this.config.app_id},success:t=>{let a=t.data.data.vars.data,n=t.data.data.theme.theme;this.$store.commit("changePoints",t.data.data.points_name),this.$store.commit("changeTheme",n),e.index.setStorageSync("TabBar",a),e.index.setStorageSync("theme",n)}})},updateWgt(t){e.index.showModal({title:"版本更新",content:"检查到有新版本，请点击更新",confirmText:"更新",showCancel:!1,success:function(a){if(a.confirm){var n=plus.downloader.createDownload(t,{},(function(t,a){e.index.showToast({title:"下载完成",mask:!1,duration:1e3}),200==a?plus.runtime.install(t.filename,{force:!0},(function(){console.log("install success..."),plus.nativeUI.alert("已更新至最新版本，确定后将重启应用",(function(){plus.runtime.restart()}),"更新提示","确定")}),(function(a){console.log(a),console.log(t.filename),e.index.showToast({title:"安装失败-01",mask:!1,duration:1500})})):e.index.showToast({title:"更新失败-02",mask:!1,duration:1500})}));try{n.start();var o=0,i=plus.nativeUI.showWaiting("正在下载");n.addEventListener("statechanged",(function(e,t){switch(e.state){case 1:i.setTitle("正在下载");break;case 2:i.setTitle("已连接到服务器");break;case 3:o=parseInt(parseFloat(e.downloadedSize)/parseFloat(e.totalSize)*100),i.setTitle("  正在下载"+o+"%  ");break;case 4:plus.nativeUI.closeWaiting()}}))}catch(r){plus.nativeUI.closeWaiting(),e.index.showToast({title:"更新失败-03",mask:!1,duration:1500})}}}})}}},l=()=>"./components/header.js",d=()=>"./components/tabbar/footTabbar.js";function g(){const t=e.createSSRApp(c);return t.component("header-bar",l),t.component("tabBar",d),t.use(s.store),t.config.globalProperties.$store=s.store,t.config.globalProperties.footTabberData={active:"home"},t.config.globalProperties.$fire=new n.OnFire,t.config.globalProperties.config=a.config,t.config.globalProperties.websiteUrl=a.config.app_url,t.config.globalProperties.app_id=e.index.getStorageSync("app_id")||a.config.app_id,t.config.globalProperties.getAppId=function(){return this.app_id||e.index.getStorageSync("app_id")||a.config.app_id||10001},t.config.globalProperties.h5_addr=a.config.h5_addr,t.config.globalProperties.gotoPage=o.gotopage,t.config.globalProperties.font_url=a.config.font_url,t.config.globalProperties.points_name=function(e){if(e){let t=new RegExp("积分","g");return e.replace(t,s.store.state.points_name)}return s.store.state.points_name},i.requestFun(t),r.validator(t),t.config.globalProperties.theme=function(){return"theme"+this.$store.state.theme||""},t.config.globalProperties.footTab=function(){return this.$store.state.footTab||""},t.config.globalProperties.getTabBarLinks=function(){let t=e.index.getStorageSync("TabBar"),a=e.index.getStorageSync("theme");null!=t&&""!=t?this.setTabBarLinks(t,a):e.index.request({url:this.config.app_url+"/index.php/api/index/nav",data:{app_id:this.config.app_id},success:t=>{let a=t.data.data.vars.data,n=t.data.data.theme.theme;this.$store.commit("changeTheme",n),e.index.setStorageSync("TabBar",a),e.index.setStorageSync("theme",n),this.setTabBarLinks(a,n)}})},t.config.globalProperties.setTabBarLinks=function(t,a){if("0"==t.is_auto){e.index.showTabBar();let n=["#ff5704","#19ad57","#ffcc00","#1774ff","#e4e4e4","#c8ba97","#623ceb"];e.index.setTabBarStyle({color:"#333333",selectedColor:n[a]}),t.list&&t.list.length>0?t.list.forEach(((t,a)=>{e.index.setTabBarItem({index:a,text:t.text,iconPath:t.iconPath,selectedIconPath:t.selectedIconPath})})):(e.index.setTabBarItem({index:0,text:"首页",iconPath:"static/tabbar/home.png",selectedIconPath:"static/tabbar/home_"+a+".png"}),e.index.setTabBarItem({index:1,text:"分类",iconPath:"static/tabbar/category.png",selectedIconPath:"static/tabbar/category_"+a+".png"}),e.index.setTabBarItem({index:2,text:"店铺",iconPath:"static/tabbar/shop.png",selectedIconPath:"static/tabbar/shop_"+a+".png"}),e.index.setTabBarItem({index:3,text:"购物车",iconPath:"static/tabbar/cart.png",selectedIconPath:"static/tabbar/cart_"+a+".png"}),e.index.setTabBarItem({index:4,text:"我的",iconPath:"static/tabbar/user.png",selectedIconPath:"static/tabbar/user_"+a+".png"}))}else e.index.hideTabBar({fail:()=>{}})},t.config.globalProperties.getShareUrlParams=function(t){let a={app_id:this.app_id,referee_id:e.index.getStorageSync("referee_id")||e.index.getStorageSync("user_id")||0};return t&&(a=Object.assign(a,t)),this.urlEncode(a)},t.config.globalProperties.urlEncode=function(e){var t=[];for(var a in e){var n=e[a];n.constructor==Array?n.forEach((e=>{t.push(a+"="+e)})):t.push(a+"="+n)}return t.join("&")},t.config.globalProperties.getThemeColor=function(){return["#ff5704","#19ad57","#ffcc00","#1774ff","#e4e4e4","#c8ba97","#623ceb"][this.$store.state.theme]},{app:t}}g().app.mount("#app"),exports.createApp=g;
